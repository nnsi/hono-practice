name = "actiko-backend"
main = "apps/backend/server.cf.ts"
compatibility_date = "2025-01-12"
compatibility_flags = ["nodejs_compat"]

# Durable Objects migrations（全環境共通）
[[migrations]]
tag = "v1"
new_sqlite_classes = ["KeyValueDO"]

# stg環境
[env.stg.vars]
NODE_ENV = "stg"
STORAGE_TYPE = "r2"

[[env.stg.durable_objects.bindings]]
name = "RATE_LIMIT_DO"
class_name = "KeyValueDO"

# production環境
[env.production.vars]
NODE_ENV = "production"
STORAGE_TYPE = "r2"

[[env.production.durable_objects.bindings]]
name = "RATE_LIMIT_DO"
class_name = "KeyValueDO"

# APM: Tail Worker にログを送信
[[env.stg.tail_consumers]]
service = "actiko-apm"

[[env.production.tail_consumers]]
service = "actiko-apm"
