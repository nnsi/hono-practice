# バックエンドの構造について

## アーキテクチャ概要

本プロジェクトのバックエンドは、クリーンアーキテクチャの原則に基づいて設計されています。主に以下の4つのレイヤーで構成されています：

1. **プレゼンテーション層（Route）**
   - HTTPリクエストの受付とルーティング
   - リクエストのバリデーション
   - 依存関係の注入
   - レスポンスの返却

2. **アプリケーション層（Handler）**
   - リクエスト/レスポンスの変換
   - エラーハンドリング
   - レスポンスのバリデーション

3. **ユースケース層（Usecase）**
   - ビジネスロジックの実装
   - ドメインエンティティの操作
   - トランザクション管理

4. **インフラストラクチャ層（Repository）**
   - データベースとの通信
   - データの永続化
   - クエリの実行

## データフロー

```txt
HTTP Request → Route → Handler → Usecase → Repository → Database
```

## レイヤー間のデータフローのルール

各レイヤー間のデータの受け渡しは、以下のルールに従います。

- **Route → Handler:**
  - Route層でリクエストボディやパラメータをバリデーションします (`zValidator` などを使用)。
  - バリデーション済みのデータを Handler層のメソッドに渡します。
  - Handler層から受け取ったレスポンスオブジェクトをそのままクライアントに返却します。
- **Handler → Usecase:**
  - Handler層は、Route層から受け取ったデータを、Usecase層で定義されたInput型 (例: `CreateTaskInputParams`) に変換して渡します。
  - Usecase層からドメインモデルなどの結果を受け取ります。
  - 受け取った結果を、レスポンススキーマ (`@dtos/response` で定義) を用いてバリデーション・整形し、Route層に返します。
- **Usecase → Repository:**
  - Usecase層は、ビジネスロジックを実行し、必要に応じてドメインモデル (例: `Task` エンティティ) を生成・操作します。
  - Repository層のメソッドには、ドメインモデルやドメインプリミティブ (例: `UserId`, `TaskId`) を渡します。
  - Repository層からドメインモデルを受け取り、Handler層に返します。
- **Repository → Database:**
  - Repository層は、Usecase層から受け取ったドメインモデルを永続化可能な形式に変換したり、データベースから取得したデータをドメインモデルに変換したりします。
  - データベースとの具体的なやり取り (例: SQLクエリの発行) を担当します。
