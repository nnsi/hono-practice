# ActivityLog CSVインポート機能 実装タスクリスト

## 概要
フロントエンド側でCSVファイルを読み込み・解析・バリデーションを行い、適切なデータに加工してからバックエンドAPIに送信する。最大500件程度の想定。

## CSVフォーマット仕様
```csv
date,activity,kind,quantity,memo
2025-01-01,ランニング,5km,30,朝ラン
2025-01-02,読書,技術書,60,TypeScript本を読んだ
2025-01-03,勉強,,120,資格勉強
```

## タスクリスト

### フロントエンド

#### CSVパース処理
- [x] CSVパーサーライブラリの選定と導入（PapaParse等）
- [x] CSVファイルの読み込み処理実装（FileReader API）
- [x] 文字エンコーディング自動検出（UTF-8、Shift-JIS対応）
- [x] CSVヘッダーの検証（必須カラムの存在チェック）

#### データ変換・バリデーション
- [x] CSV行データからActivityLog形式への変換処理
- [x] 日付フォーマットのバリデーションと正規化（YYYY-MM-DD形式）
- [x] アクティビティ名の検証（既存アクティビティとの照合）
- [x] 新規アクティビティの自動作成フラグ管理
- [x] アクティビティ種別名の検証（オプション）
- [x] 数量（quantity）のバリデーション（数値変換、負値チェック、上限チェック）
- [x] 必須フィールドの存在チェックとエラー表示

#### インポートプレビュー機能
- [x] パース済みデータのテーブル表示コンポーネント
- [x] 行ごとのバリデーション結果表示（エラー/警告/正常）
- [x] エラー行のハイライト表示
- [x] 個別データの編集機能（セル単位での修正）
- [x] 不要な行の削除機能（チェックボックス選択）

#### データ送信処理
- [x] バリデーション済みデータのバッチ送信処理
- [x] 送信進捗の管理（プログレスバー表示）
- [x] 既存APIを使った逐次送信 or バッチAPIの選択
- [x] 部分的な成功・失敗の管理

#### UIコンポーネント
- [x] CSVインポートモーダル/ページコンポーネント
- [x] ファイル選択UI（ボタン or ドラッグ&ドロップ）
- [x] CSVフォーマットのサンプル表示とダウンロード機能
- [x] インポート確認ダイアログ

#### カスタムフック
- [x] useCSVParserフックの実装（パース処理の抽象化）
- [x] useActivityLogValidatorフックの実装（バリデーションロジック）
- [x] useActivityLogImportフックの実装（全体の処理フロー管理）

#### エラーハンドリング・フィードバック
- [x] 行ごとのエラー詳細表示（エラー内容、修正方法）
- [x] エラーのあるデータのみ抽出表示機能
- [x] インポート結果サマリーの表示（成功/失敗件数）

#### テスト
- [x] CSVパース処理のユニットテスト
- [x] バリデーションロジックのユニットテスト（各種エッジケース）
- [x] useCSVParser、useActivityLogValidatorフックのテスト
- [x] インポートプレビューコンポーネントのテスト

### バックエンド

#### バッチ処理API
- [x] 複数ActivityLog一括作成エンドポイント（POST /users/activity-logs/batch）
- [x] バッチ作成用リクエストスキーマ定義（CreateActivityLogBatchRequestSchema）
- [x] トランザクション処理（全件成功 or 全件ロールバック）
- [x] バッチ処理の結果レスポンス（成功/失敗の詳細）

#### テスト
- [x] バッチAPIのユニットテスト
