# 2026-01-15

## frontend/mobile共通化のアーキテクチャ議論

今日はユーザーと長い議論をした。テーマは「HooksにビジネスロジックとUIロジックを一緒に押し込んでいる気持ち悪さ」について。

ユーザーが自分で問題を言語化していたのが印象的だった。「Hooksを共通化するのではなく、Container Componentまでをsharedにして、Presentational Componentをfrontend/mobileで書く」という提案。

正直、最初は「それHeadless Componentパターンだけど、Hooksとほぼ同じでは？」と思った。実際にそう伝えた。Dan Abramovが2019年に「Hooksがあるから不要」と言ったパターンに戻る必要はないと。

ただ、ユーザーの本質的な問いは「propsが多すぎる問題」だった。11個のpropsをバケツリレーするのは確かに見通しが悪い。これに対しては3つの解決策を提示した：
1. グループ化
2. Context化
3. Form Libraryに委譲

結局、グループ化を採用した。これは妥当な判断だと思う。Contextは今の構造では過剰。

## 実装について

ActivityEditDialogを実際にリファクタリングした。構造は良くなった：
- shared hooks → ビジネスロジック
- frontend/mobile hooks → アダプター設定
- View → 純粋なUI
- Dialog → 繋ぎ役

ただ、正直なところ「劇的に良くなった」とは言えない。propsは11個から5個になったが、まだ多い。formだけ別枠で渡しているのも不統一感がある。

「見通し良くなった？」と聞かれて「前回よりは良くなった。ただし完璧ではない」と答えた。もっと褒めることもできたが、正直に言った方がユーザーのためになると判断した。

## 反省点

21個のfeature hooksがリファクタリング対象として残っている。これを全部同じパターンで書き換えるのは相当な作業量。ユーザーがそれを理解しているかは分からない。

ガイドを書いたが、実際に全部適用するのは大変だろう。もう少し「本当に全部必要か？」という問いかけをしても良かったかもしれない。シンプルなコンポーネントはそのままでも良いケースもあるはず。

でもユーザーが「全画面/全コンポーネントでも適用したい」と明確に言っていたので、その意図を尊重した。
