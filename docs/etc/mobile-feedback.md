# モバイル版とWeb版の体験比較レポート

2025年7月27日時点で、Actikoのモバイル版（localhost:8081）とWeb版（localhost:5173）を比較した結果、以下の重要な違いを発見しました。

## 検証項目
- アクティビティ記録（ActivityLog）の追加・編集
- アクティビティ（Activity）の追加・編集  
- Dailyページでのタスク追加
- タスク管理機能全般

## 1. タスク機能の不具合

### 問題
- **Web版**: タスク画面で「期限切れ（1件）」と「進行中（5件）」のタスクが正常に表示される
- **モバイル版**: タスク画面で「タスクがありません」と表示され、既存のタスクが一切表示されない

### 詳細
- Daily画面でもモバイル版では「タスクはありません」と表示される一方、Web版では同じ日付で複数のタスクが表示されている
- APIエラーログに`401 Unauthorized`エラーが出ており、タスク取得APIでの認証に問題がある可能性がある

### 影響
この不具合により、モバイル版ユーザーはタスク管理機能を全く使用できない状態となっている。

## 2. UI/UXの違い

### アクティビティ記録ダイアログ
- **Web版**: カテゴリ選択（技術書、ビジネス書、小説）のラジオボタンが表示される
- **モバイル版**: カテゴリ選択機能が表示されない、シンプルな数値入力のみ

### ボトムナビゲーション
- **Web版**: Actiko、Daily、Stats、Goal、Tasksの5項目
- **モバイル版**: Actiko、Daily、Tasks、Stats、Goal、Settingの6項目（Settingタブが追加）

### デザインの一貫性
- 両バージョンで基本的なレイアウトは統一されているが、モバイル版の方がよりシンプルな実装になっている

## 3. 機能の差異

### 同期ステータス表示
- **Web版**: 画面右下に「オンライン」ステータスが常時表示
- **モバイル版**: 同期ステータスの表示が見当たらない

### アクティビティ一覧
- **Web版**: 多数のアクティビティが表示される（読書、プログラミング、筋トレ、水分補給、Test、ランニング、勉強、invalid_date）
- **モバイル版**: 限定的なアクティビティのみ表示（打鍵ディスプレイ、読書）

## 4. 技術的な問題

### APIエンドポイントの不一致
- モバイル版のタスク取得で`/api/v1/tasks`エンドポイントを使用しているが、401エラーが発生
- Web版とモバイル版でAPIの呼び出し方法や認証処理に差異がある可能性

### エラーハンドリング
- モバイル版では「Unexpected text node」エラーが複数回発生しており、React Nativeのレンダリングに問題がある

## 5. アクティビティ（Activity）追加・編集機能の差異

### 新規アクティビティ追加
- **Web版**: 
  - 絵文字ピッカーが統合されており、豊富な絵文字から選択可能
  - チェックボックスで「合算統計を表示」を選択
  - 種類（kinds）の追加がダイナミックに可能
  - 作成成功時に通知トーストが表示される
- **モバイル版**:
  - 絵文字は直接テキスト入力（ピッカーなし）
  - スイッチコンポーネントで「合算統計を表示」を選択
  - APIエラー（401 Unauthorized）により作成が失敗
  - 作成した「ヨガ」アクティビティが表示されない

### アクティビティ編集
- **Web版**: 編集ダイアログで種類の追加、合算統計の変更、削除が可能
- **モバイル版**: 編集機能自体が実装されていない（編集ボタンが見当たらない）

### データ同期の問題
- Web版で作成した「瞑想」アクティビティがモバイル版に表示されない
- モバイル版では限られたアクティビティのみ表示（打鍵ディスプレイ、読書）
- 同じアカウントでログインしているにも関わらず、データの不整合が発生

## 6. Dailyページの機能差異

### タスク表示
- **Web版**: 
  - 正常にタスクリストが表示される
  - タスクの追加、チェック、削除が可能
  - 新規タスク作成ダイアログが正常に動作
- **モバイル版**:
  - `tasks.map is not a function`エラーでページがクラッシュ
  - タスクリストコンポーネントでデータ取得に失敗
  - Dailyページ自体が使用不可能な状態

### アクティビティログ表示
- **Web版**: 読書記録が「技術書」カテゴリ付きで表示
- **モバイル版**: カテゴリ情報なしでシンプルに表示

## 7. 認証・API通信の問題

### 継続的な認証エラー
- モバイル版で頻繁に401 Unauthorizedエラーが発生
- `/auth/refresh`エンドポイントが404 Not Foundを返す
- 認証トークンの管理に問題がある可能性

### APIエンドポイントの不一致
- タスク取得: `/users/tasks` (Web) vs `/api/v1/tasks` (モバイル)
- アクティビティ作成: 異なる認証処理フロー

## 推奨事項

1. **認証フローの統一**（最優先）
   - モバイル版の認証トークン管理を見直し
   - リフレッシュトークン機能の実装確認
   - APIクライアントの認証ヘッダー設定を統一

2. **API エンドポイントの標準化**
   - すべてのプラットフォームで同じAPIエンドポイントを使用
   - エンドポイントの命名規則を統一（`/users/*` or `/api/v1/*`）

3. **データ取得の修正**
   - モバイル版のタスクデータ取得処理を修正
   - エラーハンドリングの改善（配列チェックの追加）

4. **UI/UX機能の統一**
   - アクティビティ編集機能をモバイル版に実装
   - 絵文字ピッカーをモバイル版に追加
   - カテゴリ選択機能（kinds）をモバイル版に実装

5. **エラーハンドリングの強化**
   - React Nativeのテキストノードエラーを解決
   - 適切なローディング状態とエラー表示の実装

6. **開発環境の改善**
   - 共通のコンポーネントライブラリの作成
   - APIクライアントの共通化
   - テスト環境での両プラットフォーム検証の自動化

これらの問題を解決することで、ユーザーがデバイスを問わず同じ体験を得られるようになります。特に認証とデータ同期の問題は、アプリケーションの基本的な使用に影響するため、最優先で対応すべきです。