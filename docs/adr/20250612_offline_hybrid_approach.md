# オフライン対応のハイブリッド方式採用

## ステータス

決定

## コンテキスト

Actikoの「最速記録」というコンセプトを実現するために、ネットワーク接続に依存しない記録機能が求められている。しかし、完全なオフライン対応（PWA + Service Worker）は技術的複雑性が高く、実装工数が5-6週間と見積もられた。

リリース前の機能として実装を検討する中で、以下の課題が明確になった：

### 現状の課題
- ネットワーク切断時に記録ができない
- 一時的な接続不良で記録が失われる  
- 「最速記録」の体験が環境に左右される

### 検討した選択肢
1. **フルオフライン対応**: PWA + Service Worker + 完全同期システム（5-6週間）
2. **ハイブリッド方式**: Web接続必須 + 記録のローカル保存（2-3週間）
3. **現状維持**: オンライン必須のまま（0週間）

## 決定事項

**ハイブリッド方式を採用する**

### 方式概要
- **Webアプリ読み込み**: インターネット接続が必要
- **記録機能**: オフラインでも活動ログ・タスクの記録可能
- **同期機能**: オンライン復帰時に自動同期
- **技術実装**: localStorage + 標準Web API

### 採用理由

1. **実装コストと効果のバランス**: 60-70%の工数削減で主要UX課題を解決
2. **技術リスクの最小化**: 枯れた技術のみ使用、デバッグが容易
3. **既存アーキテクチャとの親和性**: 認証・API構造をそのまま活用
4. **段階的発展の可能性**: 将来的なフルオフライン化への基盤

### 実装範囲
- **対象機能**: 活動ログ記録、タスク記録、基本的なゴール更新
- **対象外**: 統計閲覧、設定変更、ユーザー管理
- **技術要素**: localStorage、Navigator.onLine API、重複防止システム

## 結果

### ユーザーへの影響
**ポジティブ:**
- ネットワーク切断時でも記録継続可能
- 「最速記録」体験の一貫性向上
- データ消失リスクの大幅軽減

**制約:**
- 初回アクセス時はネット接続必須
- 統計閲覧などはオンライン時のみ
- 完全なアプリライク体験は提供不可

### システムへの影響
**フロントエンド:**
- localStorage基盤のオフライン記録システム追加
- ネットワーク状態管理とUI表示強化
- 自動同期システムの実装

**バックエンド:**
- 重複チェックAPI追加（最小限の変更）
- 同期状況確認エンドポイント追加
- 既存認証・API構造は変更なし

### 開発への影響
- **実装期間**: 2-3週間
- **技術的複雑性**: 中程度（フルオフライン比較で大幅軽減）
- **保守性**: 標準技術のみ使用で保守容易

## 備考

### 将来的な発展可能性
この実装は将来的なフルオフライン対応への基盤として機能する：
- 同期ロジックの再利用
- オフライン体験の知見蓄積
- ユーザーのオフライン利用パターン把握

### 代替案検討
フルオフライン対応は技術的に実現可能だが、以下の理由でハイブリッド方式を優先：
- リリース前実装の時間制約
- 技術的リスク軽減
- MVP的アプローチでの価値検証

### 成功指標
- ネットワーク切断による記録断絶：0件
- オンライン復帰時の同期成功率：95%以上
- ユーザーの記録継続率向上